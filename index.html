<!DOCTYPE html>
<html>
    <head>
        <!-- Meta -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Riichi Centrepiece</title>



        <!-- CSS -->
        <style>
            /* Responsive font and global styles */
            :root {
                --red: #ff5555;
                --green: #55dd55;
                --blue: #5555ff;
                --grey: #AAAAAA;

                --text-dark: #e8e6e3;
                --bg-dark: #181a1b;

                --text-light: #333333;
                --bg-light: #FFF7F1;

                --text: var(--text-light);
                --bg: var(--bg-light);

            }

            * {
                font-family: "Hiragino Mincho", "AoyagiKouzanFont2OTF", "EPSON 太行書体Ｂ", "Times New Roman", serif; 
                font-size: 10vmin;
                background-color: var(--bg);
                color: var(--text);
            }


            html, body {
                height: 100%;
            }

            html {
                display: table;
                margin: auto;
            }

            body {
                display: table-cell;
                vertical-align: middle;
            }

            p {
                -webkit-user-select: none; /* Safari */
                -ms-user-select: none; /* IE 10 and IE 11 */
                user-select: none; /* Standard syntax */
            }

            /* Multi-language support */
            [data-user-lang=en] [lang]:not([lang=en]),
            [data-user-lang=jp] [lang]:not([lang=jp]) {
                display: none;
            }


            /* Layout information */
            .container {
                display: grid;
                grid-template-areas:
                    "darkmode  top    playercount"
                    "left      naka   right"
                    "gametype bottom languageswitch";
                grid-template-columns: minmax(0, 1fr) minmax(0, 2fr) minmax(0, 1fr);
                grid-template-rows: minmax(0, 1fr) minmax(0, 2fr) minmax(0, 1fr);
            }

            #darkmode {
                grid-area: darkmode;
            }

            #playercount {
                grid-area: playercount;
            }

            #gametype {
                grid-area: gametype;
            }

            #languageswitch {
                grid-area: languageswitch;
            }

            .container > .bottom {
                grid-area: bottom;
                transform: rotate(0deg);
            }
            .container > .right {
                grid-area: right;
                transform: rotate(270deg);
            }
            .container > .top {
                grid-area: top;
                transform: rotate(180deg);
            }
            .container > .left {
                grid-area: left;
                transform: rotate(90deg);
            }

            .container > #naka {
                grid-area: naka;
            }

            .seat {
                justify-self: center;
                align-self: center;
                width: 20vmin;
                height: 20vmin;
            }

            .seat p {
                font-weight: bold;
                font-size: 20vmin;
                margin: 0;
                text-align: center;
            }

            .hidden {
                visibility: hidden;
            }

            #naka {
                justify-self: center;
                align-self: center;
                text-align: center;
            }

            #tonNakaDisplay {
                display: none;
            }

            #nanNakaDisplay {
                display: none;
            }

            #shaaNakaDisplay {
                display: none;
            }

            #peiNakaDisplay {
                display: none;
            }

            #roundinfo {
                margin: 0;
                font-weight: bold;
                font-size: 0;
            }

            .nakaDisplay {
                font-size: 0;
            }

            .nakaDisplay span {
                font-size: 10vmin;
                color: var(--blue);
            }

            #honbainfo {
                margin: 0;
                font-size: 0;
            }

            #honbainfo span {
                font-size: 8vmin;
            }

            #honbacount {
                margin: 0;
                font-size: 8vmin;
            }

            #ton p {
                color: var(--red);
            }

            .option, .option span {
                color: var(--grey);

                border-width: 0;
                font-size: 6vmin;
            }

            .selected {
                color: var(--green) !important; /* FIXME */
                font-weight: bold !important; /* FIXME */
            }
        </style>
    </head>

    <body data-user-lang="jp">
        <!-- HTML -->
        <div class="container">
            <!-- Seats -->
            <div id="ton" class="seat">
                <p class="seatwind" lang="jp">東</p>
                <p class="seatwind" lang="en">E</p>
            </div>

            <div id="nan" class="seat">
                <p class="seatwind" lang="jp">南</p>
                <p class="seatwind" lang="en">S</p>
            </div>

            <div id="shaa" class="seat">
                <p class="seatwind" lang="jp">西</p>
                <p class="seatwind" lang="en">W</p>
            </div>

            <div id="pei" class="seat">
                <p class="seatwind" lang="jp">北</p>
                <p class="seatwind" lang="en">N</p>
            </div>


            <!-- Information -->
            <div id="naka">
                <p id="roundinfo">
                    <span id="roundwind">
                        <span id="tonNakaDisplay" class="nakaDisplay">
                            <span lang="jp">東</span>
                            <span lang="en">E</span>
                        </span>
                        <span id="nanNakaDisplay" class="nakaDisplay">
                            <span lang="jp">南</span>
                            <span lang="en">S</span>
                        </span>
                        <span id="shaaNakaDisplay" class="nakaDisplay">
                            <span lang="jp">西</span>
                            <span lang="en">W</span>
                        </span>
                        <span id="peiNakaDisplay" class="nakaDisplay">
                            <span lang="jp">北</span>
                            <span lang="en">N</span>
                        </span>
                    </span>
                    <span id="roundcount"></span>

                    <span lang="jp">局</span>
                    <span lang="en"></span>
                </p>

                <p id="honbainfo"> 
                    <span id="honbacount"></span>
                    <span lang="jp">本場</span>
                    <span lang="en">H</span>
                </p>
                
            </div>

            <!-- Options -->
            <button id="darkmode" class="option"></button>

            <button id="languageswitch" class="option">Aあ</button>

            <button id="playercount" class="option"></button>

            <button id="gametype" class="option"></button>
        </div>

        <!-- Javascript -->
        <script>
            // Constants

            const WIND_TON        = 0;
            const WIND_NAN        = 1;
            const WIND_SHAA       = 2;
            const WIND_PEI        = 3;

            const POSITIONS       = ["bottom", "right", "top", "left"];   // CSS classes

            const PLAYER_DEFAULT  = 4;
            const PLAYER_SANMA    = 3;

            const ROUND_TONPUUSEN = 1;
            const ROUND_HANCHAN   = 2;
            const ROUND_IICHAN    = 4;


            // Element constants

            const TON_ELEMENT     = document.getElementById("ton");
            const NAN_ELEMENT     = document.getElementById("nan");
            const SHAA_ELEMENT    = document.getElementById("shaa");
            const PEI_ELEMENT     = document.getElementById("pei");

            const TON_NAKA        = document.getElementById("tonNakaDisplay");
            const NAN_NAKA        = document.getElementById("nanNakaDisplay");
            const SHAA_NAKA       = document.getElementById("shaaNakaDisplay");
            const PEI_NAKA        = document.getElementById("peiNakaDisplay");

            const WINDS           = [TON_NAKA, NAN_NAKA, SHAA_NAKA, PEI_NAKA];

            const WIND_DISPLAY    = document.getElementById("roundwind");

            const ROUND_INFO      = document.getElementById("roundinfo");
            const ROUND_DISPLAY   = document.getElementById("roundcount");

            const HONBA_INFO      = document.getElementById("honbainfo");
            const HONBA_DISPLAY   = document.getElementById("honbacount");

            const LANGUAGES       = ["jp", "en"];

            const DARKMODE_BTN    = document.getElementById("darkmode");
            const LANGUAGE_BTN    = document.getElementById("languageswitch");
            const PLAYERC_BTN     = document.getElementById("playercount");
            const GAMET_BTN       = document.getElementById("gametype");


            // State

            let darkMode = false;
            let language = "jp";
            let players = 4;
            let maxRounds = 2; 

            let round = 1;
            let wind = WIND_TON;
            let honba = 0;


            // Utility functions

            function isStart() {
                return round === 1 && wind === WIND_TON && honba === 0;
            }

            function reset() {
                round = 1;
                wind = WIND_TON;
                honba = 0;

                updateDisplay();
            }

            
            // Display functions

            function updateDisplay() {
                // Seat positions
                let pos = POSITIONS.slice();        // Rotating a copy
                pos = pos.splice(0, players);       // Filter out by amount of players
                
                for (let i=0; i<round-1; i++)
                    pos.push(pos.splice(0, 1)[0]);

                pos.forEach(e => {                  // Remove all position from all elements
                    TON_ELEMENT.classList.remove(e);
                    NAN_ELEMENT.classList.remove(e);
                    SHAA_ELEMENT.classList.remove(e);
                    PEI_ELEMENT.classList.remove(e);
                });
                
                TON_ELEMENT.classList.add(pos[0]);  // Apply them to each seat _ELEMENT
                NAN_ELEMENT.classList.add(pos[1]);
                SHAA_ELEMENT.classList.add(pos[2]);

                if (players === PLAYER_DEFAULT) {   // Only apply PEI if 4 players are active
                    PEI_ELEMENT.classList.add(pos[3]);
                    PEI_ELEMENT.classList.remove("hidden");
                } else {                            // Otherwise hide the PEI seat
                    PEI_ELEMENT.classList.add("hidden");
                }
                

                // Naka 
                WINDS.forEach(e => e.style.display = "none");
                WINDS[wind].style.display = "initial";
                ROUND_DISPLAY.innerText = `${round}`;
                HONBA_DISPLAY.innerText = `${honba}`;


                // Options
                if (darkMode)           // Dark mode button
                    DARKMODE_BTN.innerHTML = `&#9728;`;
                else 
                    DARKMODE_BTN.innerHTML = `&#9788;`;


                if (isStart())          // Player count button
                    if (players == PLAYER_DEFAULT)
                        PLAYERC_BTN.innerHTML = `3<span class="selected">4</span>`; 
                    else 
                        PLAYERC_BTN.innerHTML = `<span class="selected">3</span>4`;
                else 
                    PLAYERC_BTN.innerHTML = `&#10227;`;


                if (isStart())          // Gametype button
                    if (maxRounds === ROUND_TONPUUSEN) 
                        GAMET_BTN.innerHTML = `
                            <span lang="jp"><span class="selected">東</span>半一</span>
                            <span lang="en"><span class="selected">T</span>HI</span>
                            `;
                    else if (maxRounds === ROUND_HANCHAN)
                        GAMET_BTN.innerHTML = `
                            <span lang="jp">東<span class="selected">半</span>一</span>
                            <span lang="en">T<span class="selected">H</span>I</span>
                        `;
                    else
                        GAMET_BTN.innerHTML = `
                            <span lang="jp">東半<span class="selected">一</span></span>
                            <span lang="en">TH<span class="selected">I</span></span>
                        `;
                else 
                    GAMET_BTN.innerHTML = `&#10227;`;
            }


            function toggleDarkMode() {
                darkMode = !darkMode;               // Toggle bool

                // Change CSS variables
                const root = document.querySelector(":root");
                const style = root.style;
                const comp_style = window.getComputedStyle(root);

                let new_bg;
                let new_text;

                if (darkMode) { 
                    new_bg = comp_style.getPropertyValue("--bg-dark");
                    new_text = comp_style.getPropertyValue("--text-dark");
                } else {
                    new_bg = comp_style.getPropertyValue("--bg-light");
                    new_text = comp_style.getPropertyValue("--text-light");
                }

                style.setProperty("--bg", new_bg);
                style.setProperty("--text", new_text);


                // Refresh screen
                updateDisplay();
            }


            function toggleLanguage() {
                const i = LANGUAGES.indexOf(language);
                const next_lang = LANGUAGES[(i+1) % LANGUAGES.length];

                language = next_lang;
                document.body.setAttribute("data-user-lang", language);
            }



            // Round control functions

            function nextWind() {
                wind = (wind + 1) % maxRounds;      // Capping value to setting


                // Reset state (round and honba)
                round = 1;
                honba = 0;
                // Call from nextRound should update display 
            }


            function nextRound() {
                if (round === players)                  // Check if next wind
                    nextWind();
                else {
                    honba = 0;
                    round++;                            // Increment counter
                }

                updateDisplay();
            }


            function nextHonba() {
                honba++;                                // Increment counter
                updateDisplay();
            }
            

            function togglePlayerCount() {
                if (players === PLAYER_DEFAULT) 
                    players = PLAYER_SANMA;
                else
                    players = PLAYER_DEFAULT;

                updateDisplay();
            }


            function toggleGameType() {
                if (maxRounds === ROUND_TONPUUSEN)
                    maxRounds = ROUND_HANCHAN;
                else if (maxRounds === ROUND_HANCHAN)
                    maxRounds = ROUND_IICHAN;
                else
                    maxRounds = ROUND_TONPUUSEN;

                updateDisplay();
            }



            // Main

            window.onload = () => {
                // Cycling into correct information
                reset();
                updateDisplay();

                // Bindings
                ROUND_INFO.addEventListener("click", nextRound);
                HONBA_INFO.addEventListener("click", nextHonba);

                DARKMODE_BTN.addEventListener("click", toggleDarkMode);
                LANGUAGE_BTN.addEventListener("click", toggleLanguage);

                PLAYERC_BTN.addEventListener("click", () => {
                    if (isStart())
                        togglePlayerCount();
                    else
                        reset();
                });

                GAMET_BTN.addEventListener("click", () => {
                    if (isStart())
                        toggleGameType();
                    else
                        reset();
                });
            }

        </script>
        <noscript>  <!-- Hiding the entire page if no script is active -->
            <style> .container {display: none} </style>
            <span>Please enable JavaScript</span>
        </noscript>
    </body>
</html
